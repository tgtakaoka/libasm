#include "config_hd6309.h"

#include "entry_hd6309.h"
#include "table_hd6309.h"
#include "text_hd6309.h"

static constexpr Entry HD6309_P00[] PROGMEM = {
    P00(0x01, OIM,   HD6309, IMMDIR)
    P00(0x02, AIM,   HD6309, IMMDIR)
    P00(0x05, EIM,   HD6309, IMMDIR)
    P00(0x0B, TIM,   HD6309, IMMDIR)
    P00(0x14, SEXW,  HD6309, INHR)
    P00(0x61, OIM,   HD6309, IMMIDX)
    P00(0x62, AIM,   HD6309, IMMIDX)
    P00(0x65, EIM,   HD6309, IMMIDX)
    P00(0x6B, TIM,   HD6309, IMMIDX)
    P00(0x71, OIM,   HD6309, IMMEXT)
    P00(0x72, AIM,   HD6309, IMMEXT)
    P00(0x75, EIM,   HD6309, IMMEXT)
    P00(0x7B, TIM,   HD6309, IMMEXT)
    P00(0xCD, LDQ,   HD6309, IMM32)
};

static constexpr Entry HD6309_P10[] PROGMEM = {
    P10(0x30, ADDR,  HD6309, REGS)
    P10(0x31, ADCR,  HD6309, REGS)
    P10(0x32, SUBR,  HD6309, REGS)
    P10(0x33, SBCR,  HD6309, REGS)
    P10(0x34, ANDR,  HD6309, REGS)
    P10(0x35, ORR,   HD6309, REGS)
    P10(0x36, EORR,  HD6309, REGS)
    P10(0x37, CMPR,  HD6309, REGS)
    P10(0x38, PSHSW, HD6309, INHR)
    P10(0x39, PULSW, HD6309, INHR)
    P10(0x3A, PSHUW, HD6309, INHR)
    P10(0x3B, PULUW, HD6309, INHR)
    P10(0x40, NEGD,  HD6309, INHR)
    P10(0x43, COMD,  HD6309, INHR)
    P10(0x44, LSRD,  HD6309, INHR)
    P10(0x46, RORD,  HD6309, INHR)
    P10(0x47, ASRD,  HD6309, INHR)
    P10(0x48, ASLD,  HD6309, INHR)
    P10(0x48, LSLD,  HD6309, INHR)
    P10(0x49, ROLD,  HD6309, INHR)
    P10(0x4A, DECD,  HD6309, INHR)
    P10(0x4C, INCD,  HD6309, INHR)
    P10(0x4D, TSTD,  HD6309, INHR)
    P10(0x4F, CLRD,  HD6309, INHR)
    P10(0x53, COMW,  HD6309, INHR)
    P10(0x54, LSRW,  HD6309, INHR)
    P10(0x56, RORW,  HD6309, INHR)
    P10(0x59, ROLW,  HD6309, INHR)
    P10(0x5A, DECW,  HD6309, INHR)
    P10(0x5C, INCW,  HD6309, INHR)
    P10(0x5D, TSTW,  HD6309, INHR)
    P10(0x5F, CLRW,  HD6309, INHR)
    P10(0x80, SUBW,  HD6309, IMM16)
    P10(0x81, CMPW,  HD6309, IMM16)
    P10(0x82, SBCD,  HD6309, IMM16)
    P10(0x84, ANDD,  HD6309, IMM16)
    P10(0x85, BITD,  HD6309, IMM16)
    P10(0x86, LDW,   HD6309, IMM16)
    P10(0x88, EORD,  HD6309, IMM16)
    P10(0x89, ADCD,  HD6309, IMM16)
    P10(0x8A, ORD,   HD6309, IMM16)
    P10(0x8B, ADDW,  HD6309, IMM16)
    P10(0x90, SUBW,  HD6309, DIRP)
    P10(0x91, CMPW,  HD6309, DIRP)
    P10(0x92, SBCD,  HD6309, DIRP)
    P10(0x94, ANDD,  HD6309, DIRP)
    P10(0x95, BITD,  HD6309, DIRP)
    P10(0x96, LDW,   HD6309, DIRP)
    P10(0x97, STW,   HD6309, DIRP)
    P10(0x98, EORD,  HD6309, DIRP)
    P10(0x99, ADCD,  HD6309, DIRP)
    P10(0x9A, ORD,   HD6309, DIRP)
    P10(0x9B, ADDW,  HD6309, DIRP)
    P10(0xA0, SUBW,  HD6309, INDX)
    P10(0xA1, CMPW,  HD6309, INDX)
    P10(0xA2, SBCD,  HD6309, INDX)
    P10(0xA4, ANDD,  HD6309, INDX)
    P10(0xA5, BITD,  HD6309, INDX)
    P10(0xA6, LDW,   HD6309, INDX)
    P10(0xA7, STW,   HD6309, INDX)
    P10(0xA8, EORD,  HD6309, INDX)
    P10(0xA9, ADCD,  HD6309, INDX)
    P10(0xAA, ORD,   HD6309, INDX)
    P10(0xAB, ADDW,  HD6309, INDX)
    P10(0xB0, SUBW,  HD6309, EXTD)
    P10(0xB1, CMPW,  HD6309, EXTD)
    P10(0xB2, SBCD,  HD6309, EXTD)
    P10(0xB4, ANDD,  HD6309, EXTD)
    P10(0xB5, BITD,  HD6309, EXTD)
    P10(0xB6, LDW,   HD6309, EXTD)
    P10(0xB7, STW,   HD6309, EXTD)
    P10(0xB8, EORD,  HD6309, EXTD)
    P10(0xB9, ADCD,  HD6309, EXTD)
    P10(0xBA, ORD,   HD6309, EXTD)
    P10(0xBB, ADDW,  HD6309, EXTD)
    P10(0xDC, LDQ,   HD6309, DIRP)
    P10(0xDD, STQ,   HD6309, DIRP)
    P10(0xEC, LDQ,   HD6309, INDX)
    P10(0xED, STQ,   HD6309, INDX)
    P10(0xFC, LDQ,   HD6309, EXTD)
    P10(0xFD, STQ,   HD6309, EXTD)
};

static constexpr Entry HD6309_P11[] PROGMEM = {
    P11(0x30, BAND,  HD6309, BITOP)
    P11(0x31, BIAND, HD6309, BITOP)
    P11(0x32, BOR,   HD6309, BITOP)
    P11(0x33, BIOR,  HD6309, BITOP)
    P11(0x34, BEOR,  HD6309, BITOP)
    P11(0x35, BIEOR, HD6309, BITOP)
    P11(0x36, LDBT,  HD6309, BITOP)
    P11(0x37, STBT,  HD6309, BITOP)
    P11(0x38, TFM,   HD6309, TFRM) /* R+,R+ */
    P11(0x39, TFM,   HD6309, TFRM) /* R-,R- */
    P11(0x3A, TFM,   HD6309, TFRM) /* R+,R */
    P11(0x3B, TFM,   HD6309, TFRM) /* R,R+ */
    P11(0x3C, BITMD, HD6309, IMM8)
    P11(0x3D, LDMD,  HD6309, IMM8)
    P11(0x43, COME,  HD6309, INHR)
    P11(0x4A, DECE,  HD6309, INHR)
    P11(0x4C, INCE,  HD6309, INHR)
    P11(0x4D, TSTE,  HD6309, INHR)
    P11(0x4F, CLRE,  HD6309, INHR)
    P11(0x53, COMF,  HD6309, INHR)
    P11(0x5A, DECF,  HD6309, INHR)
    P11(0x5C, INCF,  HD6309, INHR)
    P11(0x5D, TSTF,  HD6309, INHR)
    P11(0x5F, CLRF,  HD6309, INHR)
    P11(0x80, SUBE,  HD6309, IMM8)
    P11(0x81, CMPE,  HD6309, IMM8)
    P11(0x86, LDE,   HD6309, IMM8)
    P11(0x8B, ADDE,  HD6309, IMM8)
    P11(0x8D, DIVD,  HD6309, IMM16)
    P11(0x8E, DIVQ,  HD6309, IMM16)
    P11(0x8F, MULD,  HD6309, IMM16)
    P11(0x90, SUBE,  HD6309, DIRP)
    P11(0x91, CMPE,  HD6309, DIRP)
    P11(0x96, LDE,   HD6309, DIRP)
    P11(0x97, STE,   HD6309, DIRP)
    P11(0x9B, ADDE,  HD6309, DIRP)
    P11(0x9D, DIVD,  HD6309, DIRP)
    P11(0x9E, DIVQ,  HD6309, DIRP)
    P11(0x9F, MULD,  HD6309, DIRP)
    P11(0xA0, SUBE,  HD6309, INDX)
    P11(0xA1, CMPE,  HD6309, INDX)
    P11(0xA6, LDE,   HD6309, INDX)
    P11(0xA7, STE,   HD6309, INDX)
    P11(0xAB, ADDE,  HD6309, INDX)
    P11(0xAD, DIVD,  HD6309, INDX)
    P11(0xAE, DIVQ,  HD6309, INDX)
    P11(0xAF, MULD,  HD6309, INDX)
    P11(0xB0, SUBE,  HD6309, EXTD)
    P11(0xB1, CMPE,  HD6309, EXTD)
    P11(0xB6, LDE,   HD6309, EXTD)
    P11(0xB7, STE,   HD6309, EXTD)
    P11(0xBB, ADDE,  HD6309, EXTD)
    P11(0xBD, DIVD,  HD6309, EXTD)
    P11(0xBE, DIVQ,  HD6309, EXTD)
    P11(0xBF, MULD,  HD6309, EXTD)
    P11(0xC0, SUBF,  HD6309, IMM8)
    P11(0xC1, CMPF,  HD6309, IMM8)
    P11(0xC6, LDF,   HD6309, IMM8)
    P11(0xCB, ADDF,  HD6309, IMM8)
    P11(0xD0, SUBF,  HD6309, DIRP)
    P11(0xD1, CMPF,  HD6309, DIRP)
    P11(0xD6, LDF,   HD6309, DIRP)
    P11(0xD7, STF,   HD6309, DIRP)
    P11(0xDB, ADDF,  HD6309, DIRP)
    P11(0xE0, SUBF,  HD6309, INDX)
    P11(0xE1, CMPF,  HD6309, INDX)
    P11(0xE6, LDF,   HD6309, INDX)
    P11(0xE7, STF,   HD6309, INDX)
    P11(0xEB, ADDF,  HD6309, INDX)
    P11(0xF0, SUBF,  HD6309, EXTD)
    P11(0xF1, CMPF,  HD6309, EXTD)
    P11(0xF6, LDF,   HD6309, EXTD)
    P11(0xF7, STF,   HD6309, EXTD)
    P11(0xFB, ADDF,  HD6309, EXTD)
};

static constexpr target::opcode_t PREFIX_P00 = 0x00;
static constexpr target::opcode_t PREFIX_P10 = 0x10;
static constexpr target::opcode_t PREFIX_P11 = 0x11;

static constexpr EntryPage HD6309_PAGES[] = {
    { PREFIX_P00, &HD6309_P00[0], ARRAY_END(HD6309_P00) },
    { PREFIX_P10, &HD6309_P10[0], ARRAY_END(HD6309_P10) },
    { PREFIX_P11, &HD6309_P11[0], ARRAY_END(HD6309_P11) },
};

template<>
Error InsnTable<HD6309>::searchName(Insn &insn) const {
    if (InsnTable<MC6809>::table()->searchName(insn) == OK)
        return OK;
    if (searchPages(insn, insn.name(), ARRAY_RANGE(HD6309_PAGES)) == OK)
        return OK;
    return UNKNOWN_INSTRUCTION;
}

template<>
Error InsnTable<HD6309>::searchNameAndAddrMode(Insn &insn) const {
    if (InsnTable<MC6809>::table()->searchNameAndAddrMode(insn) == OK)
        return OK;
    if (searchPages(insn, insn.name(), insn.addrMode(), ARRAY_RANGE(HD6309_PAGES)) == OK)
        return OK;
    return UNKNOWN_INSTRUCTION;
}

template<>
Error InsnTable<HD6309>::searchInsnCode(Insn &insn) const {
    if (InsnTable<MC6809>::table()->searchInsnCode(insn) == OK)
        return OK;
    if (searchPages(insn, insn.insnCode(), ARRAY_RANGE(HD6309_PAGES)) == OK)
        return OK;
    return UNKNOWN_INSTRUCTION;
}

static const InsnTable<HD6309> HD6309Table;

template<>
const InsnTable<HD6309> *InsnTable<HD6309>::table() {
    return &HD6309Table;
}
